<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Todo App by React</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://unpkg.com/react@16/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>
    <style>
        body{
            font-size:16px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        }
        .container{
            width:300px;
            margin:auto;
        }
        .container h1{
            font-size: 20px;
            border-bottom:1px solid #ddd;
            padding: 16px 0;
        }
        .container ul{
            padding: 0;
            list-style: none;
        }
        .container li{
            line-height: 1.5;
        }
        .container input[type="checkbox"]{
            margin-right:5px;
        }
        /* cancel button */
        .cmd{
            font-size:12px;
            cursor:pointer;
            color:#08c;
            margin-left:5px;
        }
        .container input[type="text"]{
            padding: 2px;
            margin-right:5px;
            border:1px solid #ddd;
        }
        .done{
            text-decoration: line-through;
            color:#ccc;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        (() => {
            const todos = [
                {id:0, title:'Task 0', isDone: false},
                {id:1, title:'Task 1', isDone: false},
                {id:2, title:'Task 2', isDone: true}
            ];

            function TodoItem(props){
                return(
                    <li key = {props.todo.id}>
                        <label>
                            <input type="checkbox"
                                checked={props.todo.isDone}
                                onChange={() => props.checkTodo(props.todo)}
                            />
                            <span className={props.todo.isDone ? 'done' : ''}>
                                {props.todo.title}
                            </span>
                        </label>
                        <span className = "cmd"
                                 onClick={() => props.deleteTodo(props.todo)}>[×]
                        </span>
                    </li>
                );
            }

            function TodoList(props){
                const todos = props.todos.map(todo => {
                    return(
                        <TodoItem
                         key = {todo.id}
                         todo = {todo}
                         checkTodo = {props.checkTodo}
                         deleteTodo = {props.deleteTodo}
                        />
                    );
                });
                return(
                    <ul>
                        {props.todos.length ? todos : <li>Nothing to Do!</li>}
                    </ul>
                );
            }

            function TodoForm(props){
            /*2 - make function to return form as a component*/
                return(
                    <form onSubmit={props.addTodo}>
                    {/*10 - Add onSubmit on form. Pass the props.addTodo to process in App component
                      - 処理自体はAppコンポーネント内で行いたいのでprops.addTodoとする*/}
                        <input type="text" value={props.item} onChange={props.updateItem}/>
                        {/*5 - you can directly insert (4) below to input type="text" = define value={props.item}
                         (4)をそのまま input type="text" に反映させてあげれば OK*/}
                        {/*6 - Set onChange={props.updateItem} to pass for TodoForm on App component with updateItem
                           - props.updateItem としつつ、 App コンポーネントの中で TodoForm に対して updateItem 属性を付ける
                        */}
                        <input type="submit" value="Add"/>
                    </form>
                );
            }

            class App extends React.Component{
                constructor(){
                    super();
                    this.state = {
                        todos: todos,
                        item:''
                        /*3 - Keep the data of this App as item in this state
                        (you have to manage all the data in this state)
                        ''(empty) is fine for the first time.
                        - アプリのデータはstateで一元管理する必要があるので、このstateにitemという名前で保持する*/
                    };
                    this.checkTodo = this.checkTodo.bind(this);
                    this.deleteTodo = this.deleteTodo.bind(this);
                    this.updateItem = this.updateItem.bind(this);
                    /*7 - bind updateTodo*/
                    this.addTodo = this.addTodo.bind(this);
                    /*12 - bind addTodo*/ 
                }

                addTodo(e){
                /*13 - Add addTodo() method*/
                    e.preventDefault();
                    /*14 - Add e.preventDefault() to protect from moving to other page
                     - 画面が遷移しないようにしたいので上でイベントオブジェクトを渡す + preventDefault()する*/
                    
                    const item = {};
                    /*15 - Add empty object*/

                    const todos = this.state.todos.slice();
                    /*16 - Add copy of 'todos' to update state, to add item (which defined above) on todos
                     - 上記のitemを既存のtodosに追加する前提で、stateのupdateを行うためにtodosのコピーを作成する*/
                    todos.push(item);
                    /*17 - push item to todos which sliced above - slice()したtodosに対しitemをpushする*/
                    this.setState({
                        todos: todos
                    });
                    /*18 - Set new todos to todos*/
                }

                deleteTodo(todo){
                    if(!confirm('Are you sure?')){
                        return;
                    }

                    const todos = this.state.todos.slice();
                    const pos = this.state.todos.indexOf(todo);
                    /*find the same number with todo.id passed by indexOf()
                    todos.splice(pos, 1);
                    /*delete element(1st one from 'pos') by using splice()*/
                    this.setState({
                        todos: todos
                    });
                }

                checkTodo(todo){
                    const todos = this.state.todos.map(todo => {
                        return{id: todo.id, title: todo.title, isDone: todo.isDone};
                    });

                    const pos = this.state.todos.map(todo => {
                        return todo.id;
                    }).indexOf(todo.id);

                    todos[pos].isDone = !todos[pos].isDone;
                    this.setState({
                        todos: todos
                    });
                    
                }

                updateItem(e){
                /*8 - Add updateItem() method
                - Assign 'e' as an parameter - eを引数とする*/
                    this.setState({
                        item:e.target.value
                    });
                    /* ↑ it means : item inside of state = target.value in form
                    It makes UI be able to show the actual input Thanks to this notation
                     - stateの中のitemはformのtarget.valueだよ、という意味
                     formの値はイベントオブジェクトから取得できるので、(e)を引数にしている
                     こうすることでformに入力された値がUIに反映される*/
                }

                render(){
                    return(
                        <div className="container">
                            <h1>My Todos</h1>
                            <TodoList
                            todos = {this.state.todos}
                            checkTodo = {this.checkTodo}
                            deleteTodo = {this.deleteTodo}
                            />
                            <TodoForm
                            /*1 - Add todoform component*/
                                item = {this.state.item}
                                /*4 - pass the data above(3) to here
                                value is passed by props parameter above
                                - item 属性で渡された(3)の値は function TodoForm() の props 引数で渡される*/
                                updateItem = {this.updateItem}
                                /*9 - implement 'this.updateItem' which is passed from updateItem on (6)
                                - (6)から渡されたupdateItemを'this.updateItem'としてここに実装する*/
                                addTodo = {this.addTodo}
                                /*11 - Add addTodo which passed from {props.addTodo} on (10)
                                - (10)から渡されたaddTodoを'this.addTodo'としてここに実装する*/
                            />
                        </div>
                    );
                }
            }
            ReactDOM.render(
                <App />,
                document.getElementById('root')
            );
        })();
    </script>
</body>
</html>